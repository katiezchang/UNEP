# GEF8 PIF Section Generator

This TypeScript/Node.js project generates GEF8-style PIF sections (Institutional Framework for Climate Action and National Policy Framework) using an LLM, verifies them for accuracy, and exports them to PDF.

## Overview

This project is part of a two-stage workflow:

1. **Data Extraction** (`../pdfextraction/alicia_ass7_pdfextraction/`) - Python scripts scrape UNFCCC country reports and extract relevant sections, saving them to JSON bundle files
2. **Section Generation** (this project) - Reads extracted data, uses LLM to generate polished PIF sections, verifies them, and exports to PDF

The generator reads from JSON bundle files created by the extraction scripts:
- `pdfextraction/alicia_ass7_pdfextraction/data/Institutional_framework_bundle.json`
- `pdfextraction/alicia_ass7_pdfextraction/data/National_policy_framework_bundle.json`

## Quick Start

1. **Install dependencies:**

```powershell
npm install
```

2. **Set your OpenAI API key** in an `.env` file at the project root:

```
OPENAI_API_KEY=your_key_here
```

3. **Build the project:**

```powershell
npm run build
```

4. **Generate and export PDF** (builds, generates sections, verifies, and renders PDF):

```powershell
npm run export:pdf
```

## Available Scripts

- `npm run build` - Compiles TypeScript to JavaScript in `dist/`
- `npm run dev` - Runs the generator in development mode (TypeScript directly)
- `npm run start` - Builds and runs the main generator (`src/index.ts`)
- `npm run export:pdf` - Builds, generates sections, verifies, and exports to PDF
- `npm run generate:save` - Generates sections and saves to `exported_outputs.json` only
- `npm run render:pdf` - Renders existing `exported_outputs.json` to PDF (skips generation)

## Project Structure

- `src/index.ts` - Main orchestrator that generates and verifies both sections concurrently
- `src/agents/generatorAgent.ts` - Constructs prompts and calls OpenAI LLM to generate sections
- `src/agents/verifierAgent.ts` - Verifies generated sections for accuracy and revises if needed
- `src/pdfExport.ts` - Main PDF export script that:
  - Optionally calls the Python scraper to get fresh data
  - Loads extracted data from JSON bundle files
  - Generates sections using LLM
  - Verifies and revises sections
  - Renders final sections to PDF with proper formatting
- `src/config/constants.ts` - Configuration constants and approved sources
- `dist/` - Compiled JavaScript output (generated by `npm run build`)

## How It Works

1. **Data Loading**: Reads extracted text from JSON bundle files in `pdfextraction/alicia_ass7_pdfextraction/data/`
2. **Section Generation**: Uses OpenAI GPT-4o-mini to generate polished PIF sections based on:
   - Extracted UNFCCC report data
   - GEF8 PIF format requirements
   - Country-specific information
3. **Verification**: A verification agent reviews generated sections for accuracy and consistency
4. **PDF Export**: Renders verified sections to PDF with:
   - Proper formatting (bold text, bullet points, paragraph breaks)
   - Markdown-to-PDF conversion
   - Section headers and structure

## Output Files

- `exported_outputs.json` - Generated and verified section text (JSON format)
- `exported_sections.pdf` - Final PDF document with both sections

## Integration with PDF Extraction

This project depends on the PDF extraction scripts in `../pdfextraction/alicia_ass7_pdfextraction/`:

- The extraction scripts scrape UNFCCC reports and extract relevant sections
- Extracted data is saved to JSON bundle files in the `data/` folder
- This generator reads those bundle files to get source material for LLM generation
- Optionally, `pdfExport.ts` can call the Python scraper directly to refresh data before generation

## Notes

- The generator supports rendering saved outputs from `exported_outputs.json` if present
- Institutional framework sections use bulleted lists for institutions and their roles
- National policy framework sections use bulleted lists for laws, policies, and decrees
- The PDF exporter automatically converts markdown formatting (bold, bullets) to PDF formatting
- All generated content follows GEF8 PIF format requirements and official documentation style
